
@{
    ViewData["Title"] = "Route";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Route</h2>


@section buttons{}

@section filters{}
<section class="content" style="background:white !important">
    <div class="row">
        <div class="col-md-3">
            <div class="box box-solidbox box-solid">
                <div id="DatosTabla" class="col-xs-10 col-md-10 col-lg-6 " style="overflow: auto; width: 100%; left: 20%;">
                    <table id="table-mardis" class="table table-striped table-hover mailbox-messages">
                        <thead>
                            <tr>

                                <th>Ruta</th>
                                <th>Activo</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-8 col-lg-offset-1">
            <div class="box box-primary">
                <div class="box-body no-padding">
                    <div id="VueEcuestador">

                        <div id="responsive" class="modal fade" role="dialog">
                            <div class="modal-dialog modal-lg modal-scrollable">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>

                                        <h4 class="modal-title">Encuestadores</h4>
                                    </div>

                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <!-- START LOCK SCREEN ITEM -->

                                                <v-select :items="encuestadores"
                                                          :filter="customFilter"
                                                          v-model="imei"
                                                          item-text="name"
                                                          label="Encuestador"
                                                          autocomplete></v-select>
                                                <div class="input-group-btn">
                                                    <button type="button" class="btn" v-on:click="addItem"><i class="fa fa-plus text-muted"></i></button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>IMEI</th>
                                                        <th>Nombres</th>
                                                        <th>Celular</th>
                                                    </tr>
                                                </thead>
                                                <tbody v-for="(enc, x) in poll">
                                                    <tr data-bind="attr:{id:'row'+Id}">
                                                        <td>{{x+1}}</td>
                                                        <td>{{enc.Code}} </td>
                                                        <td>{{enc.Name}}</td>
                                                        <td>{{enc.Phone}}</td>
                                                        <td>

                                                            <button type="button" class="btn btn-danger btn-sm"><i class="fa fa-trash-o" v-on:click="addRemove(x,enc.Code)"></i></button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" v-on:click="CloseModal" class="btn btn-info">Salir</button>
                                    @*<pre>{{poll||json}}</pre>*@
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
@*@{ Html.RenderPartial("_encuestador");}*@
@section Scripts {



    <script src="~/js/viewModel/EncuestadorView.js"></script>
    <script type="text/javascript">
        @*var table=  $('#datosCoord').dataTable({
        "language": {
        "url": "@Url.Content("~/js/latin.json")"
            },
            "pageLength": 25,
            "scrollX": true
             });
        </script>*@
        var table
        generarTabla();


        function generarTabla() {

            table = $('#table-mardis').dataTable({
                "language": {
                    "url": "@Url.Content("~/js/latin.json")"
                 },
                 "pageLength": 10,
                "ajax": {
                    "url": '/Campaign/ActiveRoute',
                    "type": "GET",
                    "data": function (d) {
                        return $.extend({}, d, {
                            "Id": 0
                        });
                    },
                    "dataSrc": function (json) {
                             jQuery.each(json, function (index, value) {
                                 //now you can access properties using dot notation



                                 if (json[index].status) { json[index].status = "<input type='checkbox'   class='custom-control-input' id=" + json[index].route + " checked onclick='onToggle(this)'>"; }
                                 else { json[index].status = "<input type='checkbox' class='editor-active' id=" + json[index].route + " onclick='onToggle("+json[index].route+")' >" }

                                 json[index].linkbranch = "<a href='#responsive'" + " '   onclick='ModalPerfil(this);' id=" + json[index].route + ">Encuestadores </a>";


                        });
                        return json;
                    }
                },
                "columns": [
                    { "data": "route" },
                    { "data": "status" },
                    { "data": "linkbranch" }
                ],



            }
                );
        }


        //Enable check and uncheck all functionality

        function onToggle(route) {

            $.blockUI({ message: "Actualizado Estado..." });
            $.ajax({
                url: '/Campaign/ChangeStatus',
                type: "POST",
                content: "application/json; charset=utf-8",
                data: {
                    id: route.id

                },
                success: function (data) {
                    if (data == "1") {

                        bootbox.alert("La ruta " + route.id+" fue desactivada")

                    }
                    $.unblockUI();
                },

                error: function () {

                    $.unblockUI();
                }
                //,
                //async: true, // La petición es síncrona
            });
        }
        function ModalPerfil(route) {

            LoadEquipment(route.id)
            //$("#idaccount").empty();
            //$.ajax({
            //    url: 'Account/Admin',
            //    type: "POST",
            //    content: "application/json; charset=utf-8",
            //    data: {
            //        id: 1
            //    },
            //    success: function (data) {
            //        $.each(data, function (index, value) {
            //            $("#idaccount").append("<option value=" + value.idaccount + ">" + value.account + "</option>");
            //        });
            //        $('#responsive').modal('show');
            //        GetProfile($("#idaccount").val().toString(), id);
            //    },

            //    error: function () {
            //        $("#idaccount").append("<option value=" + 0 + ">No existe Opciones</option>");
            //    },


            //});

        }

    </script>


}
