
@{
    ViewData["Menu"] = "Administración";
    ViewData["Title"] = "Rutas";
    ViewData["Description"] = "Activación de Rutas";
    Layout = "_Layout";
}

@section buttons{}

@section filters{

}


<div id="DatosTabla" class="col-xs-10 col-md-6 col-lg-6 " style="overflow: auto; width: 60%; left: 20%;">
    <table id="table-mardis" class="table table-striped table-hover mailbox-messages">
        <thead>
            <tr>

                <th>Ruta</th>
                <th>#Locales</th>
                <th>Activo</th>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

@section Scripts {

    <script type="text/javascript">
        @*var table=  $('#datosCoord').dataTable({
        "language": {
        "url": "@Url.Content("~/js/latin.json")"
            },
            "pageLength": 25,
            "scrollX": true
             });
        </script>*@
        var table
        generarTabla();


        function generarTabla() {

            table = $('#table-mardis').dataTable({
                "language": {
                    "url": "@Url.Content("~/js/latin.json")"
                 },
                 "pageLength": 25,
                "ajax": {
                    "url": '/Campaign/ActiveRoute',
                    "type": "GET",
                    "data": function (d) {
                        return $.extend({}, d, {
                            "Id": 0
                        });
                    },
                    "dataSrc": function (json) {
                             jQuery.each(json, function (index, value) {
                                 //now you can access properties using dot notation

                             

                                 if (json[index].status) { json[index].status = "<input type='checkbox'   class='custom-control-input' id=" + json[index].route + " checked onclick='onToggle(this)'>"; }
                                 else { json[index].status = "<input type='checkbox' class='editor-active' id=" + json[index].route + " onclick='onToggle("+json[index].route+")' >" }




                        });
                        return json;
                    }
                },
                "columns": [
                    { "data": "route" },
                    { "data": "numbreBranches" },
                    { "data": "status" }

                ],



            }
                );
        }   


        //Enable check and uncheck all functionality
    
        function onToggle(route) {

            $.blockUI({ message: "Actualizado Estado..." });
            $.ajax({
                url: '/Campaign/ChangeStatus',
                type: "POST",
                content: "application/json; charset=utf-8",
                data: {
                    id: route.id
                   
                },
                success: function (data) {
                    if (data == "1") { 

                        bootbox.alert("La ruta " + route.id+" fue desactivada")

                    }
                    $.unblockUI();
                },

                error: function () {

                    $.unblockUI();
                }
                //,
                //async: true, // La petición es síncrona
            });
        }

    </script>


}
